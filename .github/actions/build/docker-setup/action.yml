name: build-docker-setup
description: Sets up the environment for cross platform docker build action
inputs:
  docker-path:
    description: The path to the docker directory
    required: false
    default: docker
runs:
  using: composite
  steps:
    - id: setup-qemu
      uses: docker/setup-qemu-action@v3
    - id: setup-buildx
      uses: docker/setup-buildx-action@v3
    - id: setup-fs
      shell: bash
      run: mkdir -p "${{ inputs.docker-path }}/rootfs/opt/"
    - id: setup-release-app-artifact
      uses: actions/download-artifact@v5
      with:
        name: app-artifact-release
        path: ${{ inputs.docker-path }}/rootfs/opt/
    - id: setup-build-app-artifact
      if: failure()
      uses: actions/download-artifact@v5
      with:
        name: app-artifact-build
        path: ${{ inputs.docker-path }}/rootfs/opt/
    - id: validate-app-artifact
      if: always()
      shell: bash
      run: |
        tree -a "${{ inputs.docker-path }}/"
        tar -xOf ${{ inputs.docker-path }}/rootfs/opt/npm-pack.tgz package/package.json
    - id: build-rootfs
      if: always()
      shell: bash
      run: tar -C ${{ inputs.docker-path }}/rootfs -czf ${{ inputs.docker-path }}/rootfs.tar.gz ./