name: test-unit
description: Unit tests the JS application and uploads the coverage report
inputs:
  app-path:
    description: The path to the app directory
    required: false
    default: app
  artifact-name:
    description: The name of the uploaded coverage artifact
    required: false
    default: coverage-artifact
runs:
  using: composite
  steps:
    - id: test-unit
      shell: bash
      run: (cd ${{ inputs.app-path }}; npm run test:unit)
    - id: upload-artifact
      uses: actions/upload-artifact@v4
      with:
        name: ${{ inputs.artifact-name }}-${{ runner.os }}
        path: ${{ inputs.app-path }}/coverage/
    - id: publish-test
      uses: ctrf-io/github-test-reporter@v1
      with:
        report-path: '${{ inputs.app-path }}/coverage/ctrf-report.json'
        artifact-name: 'ctrf-report-unit'
        pull-request: true
        summary-report: true
        github-report: true
        test-report: true
        test-list-report: true
        failed-report: true
        fail-rate-report: true
        flaky-report: true
        flaky-rate-report: true
        failed-folded-report: true
        previous-results-report: true
        insights-report: true
        slowest-report: true
        ai-report: true
        skipped-report: true
        suite-folded-report: true
        suite-list-report: true
        pull-request-report: true
        commit-report: true
        custom-report: true
        community-report: true